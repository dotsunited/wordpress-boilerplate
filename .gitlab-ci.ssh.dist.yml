before_script:
  - eval $(ssh-agent -s)
  - ssh-add <(echo "$SSH_PRIVATE_KEY")
  - mkdir -p ~/.ssh
  - chmod 700 ~/.ssh
  - echo "$SSH_KNOWN_HOSTS" > ~/.ssh/known_hosts
  - chmod 644 ~/.ssh/known_hosts

deploy:
  stage: ðŸš€ Deploy
  image: dotsunited/deployer:1
  only:
    - main
    - staging
  rules:
    - if: '$CI_COMMIT_REF_NAME == "main"'
      environment:
        name: production
        url: $CI_ENVIRONMENT_URL
    - if: '$CI_COMMIT_REF_NAME == "staging"'
      environment:
        name: staging
        url: $CI_ENVIRONMENT_URL
  script:
    - dep --no-local-build --no-interaction -vvv deploy $CI_ENVIRONMENT_NAME
